#!/bin/bash
exec unicorn -nc "$0" "$@"
!#

import scala.io.Source
import unicorn.json._
import unicorn.bigtable.rocksdb._
import unicorn.unibase._
import unicorn.unibase.graph._

def feat(graph: Graph, files: String*): Unit = {
  files.foreach { file =>
    val feats = new Array[String](20000)
    Source.fromFile(file + ".featnames").getLines.foreach { line =>
      val feat = line.split(" ", 2)
      feats(feat(0).toInt) = feat(1)
    }

    Source.fromFile(file + ".feat").getLines.foreach { line =>
      val feat = line.split(" ")
      val id = feat(0)

      if (!graph.contains(id)) {
        val data = JsObject()

        for (i <- 1 until feat.length) {
          if (feat(i) == "1") {
            val f = feats(i-1).split(":")
            if (f.length > 1) data(f(0)) = f(1)
          }
        }

        graph.addVertex(id, data)
      }
    }
  }
}

def edges(graph: Graph, files: String*): Unit = {
  files.foreach { file =>
    Source.fromFile(file + ".edges").getLines.foreach { line =>
      val edge = line.split(" ")
      val source = edge(0)
      val target = edge(1)
      graph.addEdge(source, "e", target, JsNull)
    }
  }
}

val db = Unibase(RocksDB.create("/tmp/unicorn-gplus"))
db.createGraph("gplus")
val gplus = db.graph("gplus", new Snowflake(0))

feat(gplus, "../../data/gplus/100129275726588145876")
feat(gplus, "../../data/gplus/100329698645326486178")
feat(gplus, "../../data/gplus/100466178325794757407")
feat(gplus, "../../data/gplus/100500197140377336562")
feat(gplus, "../../data/gplus/100518419853963396365")
feat(gplus, "../../data/gplus/100521671383026672718")
feat(gplus, "../../data/gplus/100535338638690515335")
feat(gplus, "../../data/gplus/100637660947564674695")
feat(gplus, "../../data/gplus/100668989009254813743")
feat(gplus, "../../data/gplus/100715738096376666180")
feat(gplus, "../../data/gplus/100720409235366385249")
feat(gplus, "../../data/gplus/100962871525684315897")
feat(gplus, "../../data/gplus/101130571432010257170")
feat(gplus, "../../data/gplus/101133961721621664586")
feat(gplus, "../../data/gplus/101185748996927059931")
feat(gplus, "../../data/gplus/101263615503715477581")
feat(gplus, "../../data/gplus/101373961279443806744")
feat(gplus, "../../data/gplus/101499880233887429402")
feat(gplus, "../../data/gplus/101541879642294398860")
feat(gplus, "../../data/gplus/101560853443212199687")
feat(gplus, "../../data/gplus/101626577406833098387")
feat(gplus, "../../data/gplus/101848191156408080085")
feat(gplus, "../../data/gplus/101997124338642780860")
feat(gplus, "../../data/gplus/102170431816592344972")
feat(gplus, "../../data/gplus/102340116189726655233")
feat(gplus, "../../data/gplus/102615863344410467759")
feat(gplus, "../../data/gplus/102778563580121606331")
feat(gplus, "../../data/gplus/103236949470535942612")
feat(gplus, "../../data/gplus/103241736833663734962")
feat(gplus, "../../data/gplus/103251633033550231172")
feat(gplus, "../../data/gplus/103338524411980406972")
feat(gplus, "../../data/gplus/103503116383846951534")
feat(gplus, "../../data/gplus/103537112468125883734")
feat(gplus, "../../data/gplus/103752943025677384806")
feat(gplus, "../../data/gplus/103892332449873403244")
feat(gplus, "../../data/gplus/104076158580173410325")
feat(gplus, "../../data/gplus/104105354262797387583")
feat(gplus, "../../data/gplus/104226133029319075907")
feat(gplus, "../../data/gplus/104290609881668164623")
feat(gplus, "../../data/gplus/104607825525972194062")
feat(gplus, "../../data/gplus/104672614700283598130")
feat(gplus, "../../data/gplus/104905626100400792399")
feat(gplus, "../../data/gplus/104917160754181459072")
feat(gplus, "../../data/gplus/104987932455782713675")
feat(gplus, "../../data/gplus/105565257978663183206")
feat(gplus, "../../data/gplus/105646458226420473639")
feat(gplus, "../../data/gplus/106186407539128840569")
feat(gplus, "../../data/gplus/106228758905254036967")
feat(gplus, "../../data/gplus/106328207304735502636")
feat(gplus, "../../data/gplus/106382433884876652170")
feat(gplus, "../../data/gplus/106417861423111072106")
feat(gplus, "../../data/gplus/106724181552911298818")
feat(gplus, "../../data/gplus/106837574755355833243")
feat(gplus, "../../data/gplus/107013688749125521109")
feat(gplus, "../../data/gplus/107040353898400532534")
feat(gplus, "../../data/gplus/107203023379915799071")
feat(gplus, "../../data/gplus/107223200089245371832")
feat(gplus, "../../data/gplus/107296660002634487593")
feat(gplus, "../../data/gplus/107362628080904735459")
feat(gplus, "../../data/gplus/107459220492917008623")
feat(gplus, "../../data/gplus/107489144252174167638")
feat(gplus, "../../data/gplus/107965826228461029730")
feat(gplus, "../../data/gplus/108156134340151350951")
feat(gplus, "../../data/gplus/108404515213153345305")
feat(gplus, "../../data/gplus/108541235642523883716")
feat(gplus, "../../data/gplus/108883879052307976051")
feat(gplus, "../../data/gplus/109130886479781915270")
feat(gplus, "../../data/gplus/109213135085178239952")
feat(gplus, "../../data/gplus/109327480479767108490")
feat(gplus, "../../data/gplus/109342148209917802565")
feat(gplus, "../../data/gplus/109596373340495798827")
feat(gplus, "../../data/gplus/109602109099036550366")
feat(gplus, "../../data/gplus/110232479818136355682")
feat(gplus, "../../data/gplus/110241952466097562819")
feat(gplus, "../../data/gplus/110538600381916983600")
feat(gplus, "../../data/gplus/110581012109008817546")
feat(gplus, "../../data/gplus/110614416163543421878")
feat(gplus, "../../data/gplus/110701307803962595019")
feat(gplus, "../../data/gplus/110739220927723360152")
feat(gplus, "../../data/gplus/110809308822849680310")
feat(gplus, "../../data/gplus/110971010308065250763")
feat(gplus, "../../data/gplus/111048918866742956374")
feat(gplus, "../../data/gplus/111058843129764709244")
feat(gplus, "../../data/gplus/111091089527727420853")
feat(gplus, "../../data/gplus/111213696402662884531")
feat(gplus, "../../data/gplus/111278293763545982455")
feat(gplus, "../../data/gplus/112317819390625199896")
feat(gplus, "../../data/gplus/112463391491520264813")
feat(gplus, "../../data/gplus/112573107772208475213")
feat(gplus, "../../data/gplus/112724573277710080670")
feat(gplus, "../../data/gplus/112737356589974073749")
feat(gplus, "../../data/gplus/112787435697866537461")
feat(gplus, "../../data/gplus/113112256846010263985")
feat(gplus, "../../data/gplus/113122049849685469495")
feat(gplus, "../../data/gplus/113171096418029011322")
feat(gplus, "../../data/gplus/113356364521839061717")
feat(gplus, "../../data/gplus/113455290791279442483")
feat(gplus, "../../data/gplus/113597493946570654755")
feat(gplus, "../../data/gplus/113718775944980638561")
feat(gplus, "../../data/gplus/113799277735885972934")
feat(gplus, "../../data/gplus/113881433443048137993")
feat(gplus, "../../data/gplus/114054672576929802335")
feat(gplus, "../../data/gplus/114104634069486127920")
feat(gplus, "../../data/gplus/114122960748905067938")
feat(gplus, "../../data/gplus/114124942936679476879")
feat(gplus, "../../data/gplus/114147483140782280818")
feat(gplus, "../../data/gplus/114336431216099933033")
feat(gplus, "../../data/gplus/115121555137256496805")
feat(gplus, "../../data/gplus/115273860520983542999")
feat(gplus, "../../data/gplus/115360471097759949621")
feat(gplus, "../../data/gplus/115455024457484679647")
feat(gplus, "../../data/gplus/115516333681138986628")
feat(gplus, "../../data/gplus/115573545440464933254")
feat(gplus, "../../data/gplus/115576988435396060952")
feat(gplus, "../../data/gplus/115625564993990145546")
feat(gplus, "../../data/gplus/116059998563577101552")
feat(gplus, "../../data/gplus/116247667398036716276")
feat(gplus, "../../data/gplus/116315897040732668413")
feat(gplus, "../../data/gplus/116450966137824114154")
feat(gplus, "../../data/gplus/116807883656585676940")
feat(gplus, "../../data/gplus/116825083494890429556")
feat(gplus, "../../data/gplus/116899029375914044550")
feat(gplus, "../../data/gplus/116931379084245069738")
feat(gplus, "../../data/gplus/117412175333096244275")
feat(gplus, "../../data/gplus/117503822947457399073")
feat(gplus, "../../data/gplus/117668392750579292609")
feat(gplus, "../../data/gplus/117734260411963901771")
feat(gplus, "../../data/gplus/117798157258572080176")
feat(gplus, "../../data/gplus/117866881767579360121")
feat(gplus, "../../data/gplus/118107045405823607895")
feat(gplus, "../../data/gplus/118255645714452180374")
feat(gplus, "../../data/gplus/118379821279745746467")

edges(gplus, "../../data/gplus/100129275726588145876")
edges(gplus, "../../data/gplus/100329698645326486178")
edges(gplus, "../../data/gplus/100466178325794757407")
edges(gplus, "../../data/gplus/100500197140377336562")
edges(gplus, "../../data/gplus/100518419853963396365")
edges(gplus, "../../data/gplus/100521671383026672718")
edges(gplus, "../../data/gplus/100535338638690515335")
edges(gplus, "../../data/gplus/100637660947564674695")
edges(gplus, "../../data/gplus/100668989009254813743")
edges(gplus, "../../data/gplus/100715738096376666180")
edges(gplus, "../../data/gplus/100720409235366385249")
edges(gplus, "../../data/gplus/100962871525684315897")
edges(gplus, "../../data/gplus/101130571432010257170")
edges(gplus, "../../data/gplus/101133961721621664586")
edges(gplus, "../../data/gplus/101185748996927059931")
edges(gplus, "../../data/gplus/101263615503715477581")
edges(gplus, "../../data/gplus/101373961279443806744")
edges(gplus, "../../data/gplus/101499880233887429402")
edges(gplus, "../../data/gplus/101541879642294398860")
edges(gplus, "../../data/gplus/101560853443212199687")
edges(gplus, "../../data/gplus/101626577406833098387")
edges(gplus, "../../data/gplus/101848191156408080085")
edges(gplus, "../../data/gplus/101997124338642780860")
edges(gplus, "../../data/gplus/102170431816592344972")
edges(gplus, "../../data/gplus/102340116189726655233")
edges(gplus, "../../data/gplus/102615863344410467759")
edges(gplus, "../../data/gplus/102778563580121606331")
edges(gplus, "../../data/gplus/103236949470535942612")
edges(gplus, "../../data/gplus/103241736833663734962")
edges(gplus, "../../data/gplus/103251633033550231172")
edges(gplus, "../../data/gplus/103338524411980406972")
edges(gplus, "../../data/gplus/103503116383846951534")
edges(gplus, "../../data/gplus/103537112468125883734")
edges(gplus, "../../data/gplus/103752943025677384806")
edges(gplus, "../../data/gplus/103892332449873403244")
edges(gplus, "../../data/gplus/104076158580173410325")
edges(gplus, "../../data/gplus/104105354262797387583")
edges(gplus, "../../data/gplus/104226133029319075907")
edges(gplus, "../../data/gplus/104290609881668164623")
edges(gplus, "../../data/gplus/104607825525972194062")
edges(gplus, "../../data/gplus/104672614700283598130")
edges(gplus, "../../data/gplus/104905626100400792399")
edges(gplus, "../../data/gplus/104917160754181459072")
edges(gplus, "../../data/gplus/104987932455782713675")
edges(gplus, "../../data/gplus/105565257978663183206")
edges(gplus, "../../data/gplus/105646458226420473639")
edges(gplus, "../../data/gplus/106186407539128840569")
edges(gplus, "../../data/gplus/106228758905254036967")
edges(gplus, "../../data/gplus/106328207304735502636")
edges(gplus, "../../data/gplus/106382433884876652170")
edges(gplus, "../../data/gplus/106417861423111072106")
edges(gplus, "../../data/gplus/106724181552911298818")
edges(gplus, "../../data/gplus/106837574755355833243")
edges(gplus, "../../data/gplus/107013688749125521109")
edges(gplus, "../../data/gplus/107040353898400532534")
edges(gplus, "../../data/gplus/107203023379915799071")
edges(gplus, "../../data/gplus/107223200089245371832")
edges(gplus, "../../data/gplus/107296660002634487593")
edges(gplus, "../../data/gplus/107362628080904735459")
edges(gplus, "../../data/gplus/107459220492917008623")
edges(gplus, "../../data/gplus/107489144252174167638")
edges(gplus, "../../data/gplus/107965826228461029730")
edges(gplus, "../../data/gplus/108156134340151350951")
edges(gplus, "../../data/gplus/108404515213153345305")
edges(gplus, "../../data/gplus/108541235642523883716")
edges(gplus, "../../data/gplus/108883879052307976051")
edges(gplus, "../../data/gplus/109130886479781915270")
edges(gplus, "../../data/gplus/109213135085178239952")
edges(gplus, "../../data/gplus/109327480479767108490")
edges(gplus, "../../data/gplus/109342148209917802565")
edges(gplus, "../../data/gplus/109596373340495798827")
edges(gplus, "../../data/gplus/109602109099036550366")
edges(gplus, "../../data/gplus/110232479818136355682")
edges(gplus, "../../data/gplus/110241952466097562819")
edges(gplus, "../../data/gplus/110538600381916983600")
edges(gplus, "../../data/gplus/110581012109008817546")
edges(gplus, "../../data/gplus/110614416163543421878")
edges(gplus, "../../data/gplus/110701307803962595019")
edges(gplus, "../../data/gplus/110739220927723360152")
edges(gplus, "../../data/gplus/110809308822849680310")
edges(gplus, "../../data/gplus/110971010308065250763")
edges(gplus, "../../data/gplus/111048918866742956374")
edges(gplus, "../../data/gplus/111058843129764709244")
edges(gplus, "../../data/gplus/111091089527727420853")
edges(gplus, "../../data/gplus/111213696402662884531")
edges(gplus, "../../data/gplus/111278293763545982455")
edges(gplus, "../../data/gplus/112317819390625199896")
edges(gplus, "../../data/gplus/112463391491520264813")
edges(gplus, "../../data/gplus/112573107772208475213")
edges(gplus, "../../data/gplus/112724573277710080670")
edges(gplus, "../../data/gplus/112737356589974073749")
edges(gplus, "../../data/gplus/112787435697866537461")
edges(gplus, "../../data/gplus/113112256846010263985")
edges(gplus, "../../data/gplus/113122049849685469495")
edges(gplus, "../../data/gplus/113171096418029011322")
edges(gplus, "../../data/gplus/113356364521839061717")
edges(gplus, "../../data/gplus/113455290791279442483")
edges(gplus, "../../data/gplus/113597493946570654755")
edges(gplus, "../../data/gplus/113718775944980638561")
edges(gplus, "../../data/gplus/113799277735885972934")
edges(gplus, "../../data/gplus/113881433443048137993")
edges(gplus, "../../data/gplus/114054672576929802335")
edges(gplus, "../../data/gplus/114104634069486127920")
edges(gplus, "../../data/gplus/114122960748905067938")
edges(gplus, "../../data/gplus/114124942936679476879")
edges(gplus, "../../data/gplus/114147483140782280818")
edges(gplus, "../../data/gplus/114336431216099933033")
edges(gplus, "../../data/gplus/115121555137256496805")
edges(gplus, "../../data/gplus/115273860520983542999")
edges(gplus, "../../data/gplus/115360471097759949621")
edges(gplus, "../../data/gplus/115455024457484679647")
edges(gplus, "../../data/gplus/115516333681138986628")
edges(gplus, "../../data/gplus/115573545440464933254")
edges(gplus, "../../data/gplus/115576988435396060952")
edges(gplus, "../../data/gplus/115625564993990145546")
edges(gplus, "../../data/gplus/116059998563577101552")
edges(gplus, "../../data/gplus/116247667398036716276")
edges(gplus, "../../data/gplus/116315897040732668413")
edges(gplus, "../../data/gplus/116450966137824114154")
edges(gplus, "../../data/gplus/116807883656585676940")
edges(gplus, "../../data/gplus/116825083494890429556")
edges(gplus, "../../data/gplus/116899029375914044550")
edges(gplus, "../../data/gplus/116931379084245069738")
edges(gplus, "../../data/gplus/117412175333096244275")
edges(gplus, "../../data/gplus/117503822947457399073")
edges(gplus, "../../data/gplus/117668392750579292609")
edges(gplus, "../../data/gplus/117734260411963901771")
edges(gplus, "../../data/gplus/117798157258572080176")
edges(gplus, "../../data/gplus/117866881767579360121")
edges(gplus, "../../data/gplus/118107045405823607895")
edges(gplus, "../../data/gplus/118255645714452180374")
edges(gplus, "../../data/gplus/118379821279745746467")
